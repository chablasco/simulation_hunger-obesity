<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CB Global Hunger & Obesity Stats</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
      touch-action: none;
    }
    canvas {
      display: block;
    }
    @font-face {
      font-family: 'CooperHewittThin';
      src: url('assets/CooperHewitt-Thin.otf') format('opentype');
    }
  </style>
</head>
<body>
<script>
let hungerDeaths = 0;
let lastHungerUpdate = 0;
let hungerInterval = 3500;

let customFont;
let fontReady = false;

function preload() {
  customFont = loadFont('assets/CooperHewitt-Thin.otf', () => {
    fontReady = true;
  }, () => {
    console.warn("Font failed to load. Using default.");
    fontReady = false;
  });
}

function setup() {
  createCanvas(windowWidth, windowHeight);
  textAlign(CENTER, CENTER);
  noCursor();
  hungerDeaths = getInitialHungerDeaths();
}

function draw() {
  background(0);

  if (fontReady) {
    textFont(customFont);
  } else {
    textFont('monospace');
  }

  let nowMillis = millis();

  if (nowMillis - lastHungerUpdate > hungerInterval) {
    hungerDeaths++;
    lastHungerUpdate = nowMillis;
  }

  // NEW WORKING OBESITY COUNTER
  let now = Date.now(); // current time in milliseconds
  let start = new Date('2025-01-01T00:00:00Z').getTime(); // start time in milliseconds
  let secondsElapsed = Math.floor((now - start) / 1000);
  let obesePeople = 1000000 + Math.floor(secondsElapsed / 1.2);

  // Drawing
  let minSize = min(width, height);
  let numberSize = minSize * 0.12;
  let subtextSize = minSize * 0.045;
  let lineSpacing = minSize * 0.04;
  let blockSpacing = minSize * 0.08;
  let totalHeight = 2 * (numberSize + subtextSize + lineSpacing) + blockSpacing;
  let topY = (height - totalHeight) / 2;

  fill(255);
  textSize(numberSize);
  text(formatNumber(hungerDeaths), width / 2, topY + numberSize / 2);

  fill(160);
  textSize(subtextSize);
  text("people in the world have died of hunger today simulation", width / 2, topY + numberSize + lineSpacing + subtextSize / 2);

  let secondBlockY = topY + numberSize + subtextSize + lineSpacing + blockSpacing;

  fill(255);
  textSize(numberSize);
  text(formatNumber(obesePeople), width / 2, secondBlockY + numberSize / 2);

  fill(160);
  textSize(subtextSize);
  text("people in the world are obese simulation", width / 2, secondBlockY + numberSize + lineSpacing + subtextSize / 2);
}

function getInitialHungerDeaths() {
  let now = new Date();
  let s = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
  return Math.floor(s / 3.5);
}

function formatNumber(n) {
  return n.toLocaleString('en').replace(/,/g, ' ');
}

function mousePressed() {
  fullscreen(!fullscreen());
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
